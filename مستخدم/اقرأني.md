# مجلد بيئات المستخدمين الشخصية

<div dir="rtl">

## الوصف المعماري الشامل

يمثل مجلد `/مستخدم` جوهر نموذج الأمان متعدد المستخدمين (Multi-User Security Model) في توزيعة لينكس العربية. هذا المجلد يقابل المجلد `/home` في توزيعات لينكس التقليدية، ويعد بمثابة نظام عزل البيانات (Data Isolation System) الذي يضمن الخصوصية والأمان لكل مستخدم على النظام.

## الأسس المعمارية والفلسفة التصميمية

### ١. العزل على مستوى فضاء المستخدم (User Space Isolation)

يطبق هذا المجلد مبدأ العزل الصارم (Strict Isolation) بين بيئات المستخدمين المختلفة، مما يحقق:

#### الفصل التام للبيانات (Complete Data Segregation)
- **الحماية على مستوى نظام الملفات (Filesystem-level Protection)**: استخدام صلاحيات POSIX (chmod/chown)
- **قوائم التحكم بالوصول الموسعة (Extended ACLs)**: لتحكم دقيق في الصلاحيات
- **فضاءات الأسماء (Namespaces)**: عزل موارد النظام لكل مستخدم
- **مجموعات التحكم (Control Groups - cgroups)**: تحديد استهلاك الموارد لكل مستخدم

#### الخصوصية المعززة (Enhanced Privacy)
- **التشفير على مستوى المجلد (Directory-level Encryption)**: باستخدام eCryptfs أو LUKS
- **المصادقة متعددة العوامل (Multi-Factor Authentication)**: للوصول إلى البيانات الحساسة
- **التدقيق والمراقبة (Auditing)**: تتبع جميع عمليات الوصول

### ٢. إدارة الحصص والموارد (Quota and Resource Management)

#### نظام حصص القرص (Disk Quota System)
```bash
# تعيين حصة للمستخدم
edquota -u اسم_المستخدم

# الحد الناعم (Soft Limit): 10GB
# الحد الصلب (Hard Limit): 15GB
# مهلة تجاوز الحد الناعم (Grace Period): 7 أيام
```

المفاهيم المرتبطة:
- **حصص الكتل (Block Quotas)**: تحديد المساحة المستخدمة
- **حصص العقد (Inode Quotas)**: تحديد عدد الملفات
- **الحصص الجماعية (Group Quotas)**: حصص على مستوى المجموعة

#### إدارة الموارد الحاسوبية
- **حدود CPU**: عبر cgroups (`cpu.cfs_quota_us`)
- **حدود الذاكرة**: تحديد استهلاك RAM لكل مستخدم
- **حدود عمليات الإدخال/الإخراج (I/O Throttling)**: منع احتكار قرص التخزين

### ٣. البنية الهرمية المتقدمة (Advanced Hierarchical Structure)

```
/مستخدم
├── جذر/                      # المجلد الشخصي للمستخدم الممتاز (Superuser Home)
│   ├── .bashrc              # تكوين الصدفة Bash
│   ├── .bash_profile        # ملف تهيئة الدخول
│   ├── .ssh/                # مفاتيح SSH والتكوينات
│   │   ├── id_rsa          # المفتاح الخاص (Private Key)
│   │   ├── id_rsa.pub      # المفتاح العام (Public Key)
│   │   ├── authorized_keys # المفاتيح المصرح بها
│   │   └── config          # تكوين عميل SSH
│   ├── .gnupg/              # مفاتيح التشفير GPG
│   └── .config/             # تكوينات التطبيقات الحديثة (XDG Base Directory)
│       ├── systemd/         # خدمات المستخدم systemd
│       └── التطبيقات/       # تكوينات التطبيقات المختلفة
├── عام/                     # مجلد المشاركة العامة (Public Share)
│   ├── مشترك/              # ملفات مشتركة بين المستخدمين
│   └── إسقاط/              # مجلد Drop Box للمشاركة
└── قوالب/                   # قوالب المجلدات الشخصية (Skeleton Directory)
    ├── .bashrc              # القالب الافتراضي لـ bashrc
    ├── .profile             # القالب الافتراضي لـ profile
    └── المستندات/           # هيكل المجلدات الافتراضي
        ├── التنزيلات/
        ├── الصور/
        ├── المستندات/
        └── سطح_المكتب/
```

## المفاهيم التقنية المتقدمة

### نظام UID/GID (User and Group Identifiers)

#### المعرفات الرقمية الفريدة
كل مستخدم يُعرّف برقم فريد (UID):
- **UID 0**: المستخدم الجذر (root) - صلاحيات مطلقة
- **UID 1-999**: حسابات النظام (System Accounts) - للخدمات والبرامج الخلفية
- **UID 1000+**: المستخدمون العاديون (Regular Users)

معلومات المستخدم تُخزن في:
- **/etc/passwd**: معلومات المستخدمين الأساسية
- **/etc/shadow**: كلمات المرور المشفرة (Hashed Passwords)
- **/etc/group**: المجموعات والعضويات

صيغة `/etc/passwd`:
```
اسم_المستخدم:x:UID:GID:الاسم_الكامل:المجلد_الشخصي:الصدفة_الافتراضية
أحمد:x:1001:1001:أحمد محمد:/مستخدم/أحمد:/bin/bash
```

### خوارزميات التشفير وتجزئة كلمات المرور (Password Hashing)

#### الخوارزميات المدعومة
- **SHA-512**: خوارزمية التجزئة الآمنة (Secure Hash Algorithm)
  - طول الملخص: 512 بت
  - مقاومة عالية لهجمات القوة الغاشمة
  
- **bcrypt**: خوارزمية Blowfish المكيفة
  - عامل التكلفة القابل للضبط (Cost Factor)
  - مقاومة هجمات ASIC
  
- **Argon2**: الفائز بمسابقة تجزئة كلمات المرور
  - مقاوم لهجمات GPU
  - حماية ضد الهجمات الجانبية (Side-Channel Attacks)

صيغة في `/etc/shadow`:
```
اسم_المستخدم:$id$salt$hash:آخر_تغيير:حد_أدنى:حد_أقصى:تحذير:...
```
حيث `$id$` يحدد الخوارزمية:
- `$1$`: MD5 (قديم، غير مستحسن)
- `$5$`: SHA-256
- `$6$`: SHA-512 (مستحسن)
- `$2b$`: bcrypt
- `$argon2id$`: Argon2

### معيار XDG Base Directory (XDG Base Directory Specification)

تنظيم حديث لملفات المستخدم:

```bash
# ملفات التكوين
XDG_CONFIG_HOME=~/.config

# ملفات البيانات
XDG_DATA_HOME=~/.local/share

# ملفات التخزين المؤقت
XDG_CACHE_HOME=~/.cache

# ملفات الحالة
XDG_STATE_HOME=~/.local/state

# ملفات التشغيل (Runtime)
XDG_RUNTIME_DIR=/run/user/$UID
```

الفوائد:
- **تنظيم أفضل**: فصل أنواع البيانات المختلفة
- **سهولة النسخ الاحتياطي**: معرفة أين تُحفظ البيانات المهمة
- **التوافق مع التطبيقات الحديثة**: معظم التطبيقات تدعم هذا المعيار

### PAM (Pluggable Authentication Modules)

نظام مرن للمصادقة:

```
# /etc/pam.d/login
auth    required    pam_unix.so         # المصادقة التقليدية
auth    required    pam_faildelay.so    # تأخير بعد الفشل
account required    pam_unix.so         # التحقق من الحساب
password required   pam_pwquality.so    # متطلبات قوة كلمة المرور
session required    pam_limits.so       # تطبيق حدود الموارد
```

الوحدات المتقدمة:
- **pam_google_authenticator**: المصادقة الثنائية (2FA)
- **pam_ldap**: المصادقة عبر LDAP
- **pam_krb5**: المصادقة عبر Kerberos
- **pam_fprintd**: المصادقة ببصمة الإصبع

## الأمان والحماية المتقدمة

### SELinux (Security-Enhanced Linux) Contexts

كل مجلد مستخدم له سياق أمني:
```bash
# عرض السياق الأمني
ls -Z /مستخدم/أحمد
# النتيجة:
# unconfined_u:object_r:user_home_dir_t:s0
```

السياسات المطبقة:
- **Type Enforcement**: فصل الصلاحيات حسب النوع
- **Role-Based Access Control (RBAC)**: التحكم حسب الدور
- **Multi-Level Security (MLS)**: مستويات أمنية متعددة

### AppArmor Profiles

ملفات تعريف لتقييد التطبيقات:
```
# /etc/apparmor.d/usr.bin.firefox
/مستخدم/*/التنزيلات/** rw,     # قراءة وكتابة في التنزيلات
/مستخدم/*/.mozilla/** rw,      # البيانات الخاصة بـ Firefox
/etc/hosts r,                    # قراءة فقط لـ hosts
deny /etc/shadow r,              # منع قراءة shadow
```

### الحاويات والعزل (Containers and Sandboxing)

#### Flatpak / Snap
- **عزل التطبيقات**: كل تطبيق في حاوية منعزلة
- **البيانات الخاصة**: `~/.var/app/<app-id>/`
- **صلاحيات محدودة**: طلب الإذن للوصول للموارد

#### Firejail
```bash
# تشغيل متصفح معزول
firejail --private=/مستخدم/أحمد/خاص firefox
```

## الأداء والتحسين (Performance Optimization)

### نظام الملفات المناسب (Filesystem Choice)

#### Btrfs - نظام ملفات B-tree
مميزات متقدمة:
- **اللقطات (Snapshots)**: نسخ لحظية للبيانات
- **النسخ عند الكتابة (Copy-on-Write)**: كفاءة في استخدام المساحة
- **الضغط الشفاف (Transparent Compression)**: توفير المساحة تلقائياً
- **إلغاء التكرار (Deduplication)**: حذف البيانات المكررة

#### ZFS - نظام الملفات Zettabyte
- **التكامل**: مجموع اختباري لكل بيانة
- **RAID-Z**: حماية من فقدان البيانات
- **ARC (Adaptive Replacement Cache)**: تخزين مؤقت ذكي

### التخزين المؤقت والأداء (Caching Strategies)

#### bcache / dm-cache
- استخدام SSD كتخزين مؤقت لـ HDD
- تسريع الوصول للبيانات المستخدمة بكثرة

#### tmpfs للملفات المؤقتة
```bash
# تحميل /tmp في الذاكرة
tmpfs   /tmp    tmpfs   defaults,noatime,mode=1777  0 0
```

## التكامل مع خدمات الدليل (Directory Services Integration)

### LDAP (Lightweight Directory Access Protocol)
- **الدليل المركزي**: تخزين معلومات المستخدمين مركزياً
- **المصادقة الموحدة (Single Sign-On)**: دخول واحد لأنظمة متعددة
- **المزامنة**: مجلدات المستخدمين تُنشأ تلقائياً

### Active Directory Integration
- **Samba/Winbind**: التكامل مع بيئات Windows
- **SSSD**: خدمة أمان النظام (System Security Services Daemon)

## أفضل الممارسات المتقدمة

### النسخ الاحتياطي (Backup Strategies)
1. **النسخ الاحتياطي التزايدي (Incremental)**: rsync, borgbackup
2. **اللقطات (Snapshots)**: Btrfs, ZFS, LVM
3. **النسخ الاحتياطي السحابي**: rclone إلى S3, GCS

### المراقبة والتدقيق (Monitoring & Auditing)
```bash
# تفعيل التدقيق على المجلدات الشخصية
auditctl -w /مستخدم -p wa -k مراقبة_المستخدمين

# عرض سجلات التدقيق
ausearch -k مراقبة_المستخدمين
```

### الصيانة الدورية
- **تنظيف الملفات المؤقتة**: tmpreaper, systemd-tmpfiles
- **تحديد الملفات الكبيرة**: ncdu, dust
- **التحقق من سلامة النظام**: SMART للأقراص

</div>

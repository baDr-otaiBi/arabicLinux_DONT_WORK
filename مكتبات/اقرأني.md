# مجلد المكتبات المشتركة والموارد

<div dir="rtl">

## الوصف المعماري الشامل

يمثل مجلد `/مكتبات` النظام الأساسي للربط الديناميكي والموارد المشتركة (Dynamic Linking and Shared Resources System) في توزيعة لينكس العربية. هذا المجلد يقابل المجلدات `/lib`، `/lib64`، `/usr/lib` في توزيعات لينكس التقليدية، ويعد حجر الأساس لمبدأ إعادة استخدام الشيفرة (Code Reusability) وتقاسم الموارد (Resource Sharing).

## الأسس المعمارية والتقنية

### ١. نموذج المكتبات الديناميكية المشتركة (Shared Object Model)

#### مفهوم الربط الديناميكي (Dynamic Linking)

في أنظمة التشغيل الحديثة، تُبنى البرامج بطريقتين:

##### الربط الثابت (Static Linking)
```
البرنامج ← [شيفرة البرنامج + المكتبة الكاملة] = ملف تنفيذي ضخم
```
- **الميزة**: استقلالية كاملة، لا يحتاج مكتبات خارجية
- **العيب**: حجم كبير، تكرار الشيفرة، صعوبة التحديث

##### الربط الديناميكي (Dynamic Linking)
```
البرنامج ← [شيفرة البرنامج] + مرجع إلى المكتبة المشتركة (*.so)
                                    ↓
                        المكتبة المشتركة في /مكتبات
```
- **الميزة**: حجم صغير، توفير الذاكرة، سهولة التحديث
- **العيب**: اعتمادية خارجية (Dependency Hell)

#### آلية تحميل المكتبات (Library Loading Mechanism)

##### محمل الربط الديناميكي (Dynamic Linker/Loader)
- **ld.so** / **ld-linux.so**: المحمل الأساسي في لينكس
- **المسار**: `/lib64/ld-linux-x86-64.so.2` (للأنظمة 64-bit)

##### عملية التحميل:
```
1. تنفيذ البرنامج
   ↓
2. قراءة رأسية ELF (Executable and Linkable Format)
   ↓
3. تحديد المكتبات المطلوبة من قسم NEEDED
   ↓
4. البحث عن المكتبات في:
   - LD_LIBRARY_PATH (متغير بيئي)
   - /etc/ld.so.cache (ذاكرة التخزين المؤقت)
   - /lib، /usr/lib (المسارات الافتراضية)
   ↓
5. تحميل المكتبات في الذاكرة
   ↓
6. حل الرموز (Symbol Resolution)
   ↓
7. إعادة التوطين (Relocation)
   ↓
8. تنفيذ البرنامج
```

### ٢. البنية الهرمية المتقدمة

```
/مكتبات
├── مشتركة/                         # المكتبات الديناميكية الأساسية
│   ├── libc.so.6                   # مكتبة C القياسية (GNU C Library - glibc)
│   │   # الوظائف: malloc, printf, strcpy, socket, ...
│   │   # الحجم: ~2.5 MB
│   │   # الاعتماديات: ld-linux.so
│   │
│   ├── libpthread.so.0             # مكتبة الخيوط POSIX (POSIX Threads)
│   │   # الوظائف: pthread_create, pthread_mutex_lock, ...
│   │   # دعم البرمجة متعددة الخيوط (Multithreading)
│   │
│   ├── libm.so.6                   # مكتبة الرياضيات (Math Library)
│   │   # الوظائف: sin, cos, sqrt, pow, log, ...
│   │   # دعم العمليات الحسابية المعقدة
│   │
│   ├── libssl.so.3                 # مكتبة OpenSSL للتشفير
│   │   # بروتوكولات: TLS/SSL
│   │   # خوارزميات: RSA, AES, SHA, ...
│   │
│   ├── libcrypto.so.3              # مكتبة العمليات التشفيرية
│   │   # التشفير المتماثل واللامتماثل
│   │   # التوقيعات الرقمية
│   │
│   ├── libz.so.1                   # مكتبة الضغط zlib
│   │   # خوارزمية DEFLATE
│   │   # استخدامات: gzip, PNG, ...
│   │
│   ├── libreadline.so.8            # مكتبة قراءة الأسطر
│   │   # تحرير سطر الأوامر
│   │   # التاريخ والإكمال التلقائي
│   │
│   └── libncurses.so.6             # مكتبة واجهة النص (Text User Interface)
│       # إنشاء واجهات نصية تفاعلية
│       # النوافذ والقوائم في الطرفية
│
├── نواة/                           # وحدات النواة القابلة للتحميل (Kernel Modules)
│   ├── تشغيل_الأجهزة/             # برامج تشغيل الأجهزة (Device Drivers)
│   │   ├── شبكة/                  # برامج تشغيل الشبكة
│   │   │   ├── e1000e.ko          # Intel Ethernet
│   │   │   └── iwlwifi.ko         # Intel WiFi
│   │   ├── تخزين/                 # برامج تشغيل التخزين
│   │   │   ├── ahci.ko            # SATA Controller
│   │   │   └── nvme.ko            # NVMe SSD
│   │   └── رسوميات/               # برامج تشغيل الرسوميات
│   │       ├── i915.ko            # Intel Graphics
│   │       └── nouveau.ko         # NVIDIA (Open Source)
│   │
│   └── أنظمة_الملفات/             # أنظمة الملفات
│       ├── ext4.ko                # Extended Filesystem 4
│       ├── btrfs.ko               # B-tree Filesystem
│       └── xfs.ko                 # XFS Filesystem
│
├── python/                         # مكتبات Python
│   ├── site-packages/             # حزم الطرف الثالث
│   │   ├── numpy/                 # حسابات رقمية
│   │   ├── pandas/                # تحليل البيانات
│   │   └── django/                # إطار عمل الويب
│   └── stdlib/                    # المكتبة القياسية
│
├── عربية/                         # مكتبات اللغة العربية
│   ├── معالجة_النصوص/            # معالجة النصوص العربية (NLP)
│   │   ├── تشكيل.so              # إضافة التشكيل التلقائي
│   │   ├── تجذير.so              # استخلاص الجذور (Stemming)
│   │   └── تحليل_صرفي.so         # التحليل الصرفي (Morphological Analysis)
│   │
│   ├── خطوط/                      # خطوط عربية
│   │   ├── نسخ/                  # خط النسخ
│   │   ├── ثلث/                  # خط الثلث
│   │   └── كوفي/                 # خط كوفي
│   │
│   └── ترميز/                     # دعم الترميز العربي
│       ├── UTF-8.so
│       └── ISO-8859-6.so
│
└── firmware/                       # البرمجيات الثابتة (Firmware)
    ├── بلوتوث/                    # برمجيات Bluetooth
    ├── واي_فاي/                   # برمجيات WiFi
    └── رسوميات/                   # برمجيات GPU
```

## المفاهيم التقنية المتقدمة

### إدارة الإصدارات (Versioning System)

#### تنسيق SONAME (Shared Object Name)
```
libمثال.so.MAJOR.MINOR.PATCH
     ↓      ↓     ↓      ↓
  الاسم   النوع  رئيسي ثانوي رقعة
```

مثال: `libc.so.6.2.35`
- **الاسم**: libc
- **الإصدار الرئيسي**: 6 (تغييرات غير متوافقة)
- **الإصدار الثانوي**: 2 (إضافات متوافقة)
- **الرقعة**: 35 (إصلاحات أخطاء)

#### الروابط الرمزية (Symbolic Links)
```bash
libc.so.6.2.35          # الملف الفعلي
libc.so.6 → libc.so.6.2.35   # رابط التشغيل
libc.so → libc.so.6          # رابط التطوير
```

### تقنيات التحسين المتقدمة

#### Position Independent Code (PIC)
- **الغرض**: السماح بتحميل المكتبة في أي عنوان ذاكرة
- **الخيار**: `-fPIC` عند الترجمة
- **الفائدة**: ASLR (Address Space Layout Randomization) للأمان

#### Link Time Optimization (LTO)
- **الآلية**: تحسين عبر وحدات الترجمة المختلفة
- **الناتج**: شيفرة أسرع وأصغر
- **الأدوات**: GCC LTO، LLVM ThinLTO

#### Lazy Binding (الربط الكسول)
```
البرنامج يبدأ
   ↓
لا يتم حل جميع الرموز فوراً
   ↓
حل الرمز عند أول استخدام فقط (PLT/GOT)
   ↓
تحسين وقت البدء
```

### الأمان والحماية

#### RELRO (Relocation Read-Only)
```bash
# Full RELRO - حماية كاملة
gcc -Wl,-z,relro,-z,now

# الفائدة: منع هجمات GOT Overwrite
```

#### Stack Canaries
- **الآلية**: قيم عشوائية في المكدس
- **الكشف**: تلف المكدس عند تغيير القيمة
- **الخيار**: `-fstack-protector-strong`

#### FORTIFY_SOURCE
- **المستوى 1**: فحص وقت الترجمة
- **المستوى 2**: فحوصات إضافية في وقت التشغيل
- **الخيار**: `-D_FORTIFY_SOURCE=2`

### أنظمة إدارة التبعيات (Dependency Management)

#### ldd (List Dynamic Dependencies)
```bash
$ ldd /usr/bin/ls
    linux-vdso.so.1        # Virtual Dynamic Shared Object
    libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6
    /lib64/ld-linux-x86-64.so.2
```

#### ldconfig - محدث ذاكرة التخزين المؤقت
```bash
# تحديث قاعدة بيانات المكتبات
ldconfig

# قراءة من: /etc/ld.so.conf
# الكتابة إلى: /etc/ld.so.cache

# البحث السريع بدلاً من فحص الملفات في كل مرة
```

#### pkg-config - معلومات الترجمة
```bash
# الحصول على خيارات الترجمة
pkg-config --cflags --libs gtk+-3.0

# النتيجة:
# -pthread -I/usr/include/gtk-3.0 ... -lgtk-3 -lgdk-3 ...
```

### تقنيات التحميل المتقدمة

#### Preloading (التحميل المسبق)
```bash
# تحميل مكتبة قبل البرنامج
LD_PRELOAD=/مكتبات/مكتبة_مخصصة.so البرنامج

# الاستخدام:
# - اعتراض استدعاءات النظام (System Call Interception)
# - التصحيح (Debugging)
# - القياس (Profiling)
```

#### dlopen/dlsym - التحميل اليدوي
```c
#include <dlfcn.h>

// فتح المكتبة
void *handle = dlopen("libمثال.so", RTLD_LAZY);

// الحصول على رمز (دالة)
void (*func)(void) = dlsym(handle, "اسم_الدالة");

// استدعاء الدالة
func();

// إغلاق المكتبة
dlclose(handle);
```

## وحدات النواة القابلة للتحميل (Loadable Kernel Modules)

### البنية والإدارة

#### معلومات الوحدة
```bash
# عرض الوحدات المحملة
lsmod

# معلومات تفصيلية عن وحدة
modinfo e1000e

# النتيجة:
# filename:       /lib/modules/.../e1000e.ko
# version:        3.8.4-k
# license:        GPL
# description:    Intel(R) PRO/1000 Network Driver
# author:         Intel Corporation
```

#### التحميل والإزالة
```bash
# تحميل وحدة
modprobe e1000e

# إزالة وحدة
modprobe -r e1000e

# تحميل مع معاملات
modprobe e1000e debug=2
```

### توقيع الوحدات (Module Signing)
- **الغرض**: التحقق من أصالة الوحدة
- **الآلية**: توقيعات رقمية باستخدام مفاتيح X.509
- **التطبيق**: Secure Boot

## الأداء والتحسين

### تحسين الذاكرة

#### Shared Memory Pages
```
برنامج 1 ← المكتبة المشتركة في الذاكرة → برنامج 2
                     ↓
           صفحة ذاكرة واحدة مشتركة
           توفير كبير في استخدام RAM
```

#### Copy-on-Write (COW)
- عند استخدام fork()، المكتبات المشتركة لا تُنسخ
- النسخ فقط عند الكتابة
- كفاءة عالية في استخدام الموارد

### Profile-Guided Optimization (PGO)
```bash
# 1. ترجمة مع تمكين القياس
gcc -fprofile-generate ...

# 2. تشغيل البرنامج (جمع بيانات)
./program

# 3. إعادة الترجمة مع التحسين
gcc -fprofile-use ...

# النتيجة: تحسين 10-20% في الأداء
```

## التطبيقات المستقبلية

### مكتبات اللغة العربية المتقدمة
- **التعرف على الكلام العربي (ASR)**: استخدام نماذج التعلم العميق
- **تحليل المشاعر**: فهم النصوص العربية
- **الترجمة الآلية العصبية (NMT)**: ترجمة عالية الجودة

### تقنيات حديثة
- **WebAssembly (WASM)**: تشغيل شيفرة عالية الأداء في المتصفح
- **eBPF Libraries**: برمجة النواة الآمنة
- **Rust Shared Libraries**: مكتبات آمنة من حيث الذاكرة

</div>
